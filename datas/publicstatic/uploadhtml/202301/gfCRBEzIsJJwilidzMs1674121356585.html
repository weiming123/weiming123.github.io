<p>  自己的个人网站终于上线啦，早就想做给自己的个人网站了，但是无赖实在太懒了自己，又不想用模板这些来搭建，就想自己全部来开发。刚上线不久，本来还挺开心的，毕竟服务器配置用得差，结果网站响应速度还是挺不错的。<br>  但是最近发现网站响应变慢了，结果一查郁闷了。首先我们来查看服务器磁盘使用状况,我的服务器是使用的Ubuntu操作系统，可以使用命令：dh -hl,如下图：<br><span class="figure"><img src="/datas/publicstatic/uploadimg/202301/ucOlabPpOmubLZzYyba1674121316056.png" title="" alt="" zoom="" class="medium-zoom-image"><span class="figcaption"></span></span></p>
<p>  哦买噶，好心疼啊，阿里云买的40G空间竟然用完了，原本以为40G空间应该完全够用了才是啊，竟然这么快。。。一查，果然是日志太多了，以前想的日志估计不会太多，设置过一段时间自动清理，但是远远没到时间啊！<br>  咦，就是这样子服务器还在跑吗？<br>  使用pm2 list查看，好吧，服务器压根不在线了，再一看页面network请求，如下图：<br><span class="figure"><img src="/datas/publicstatic/uploadimg/202301/KoJLwJwvQWcrgcQTcfU1674121327226.png" title="" alt="" zoom="" class="medium-zoom-image"><span class="figcaption"></span></span></p>
<p>  好吧，全是ServiceWorker了！原来自己之所以还能打开，全是因为ServiceWorker做的离线缓存啊，亏我还以为自己服务器跑的好好的呢！<br>  这种时候赶紧查查吧，虽然真的好气，我这种垃圾服务器还有人搞，自己连软件都舍不得跑几个的，毕竟服务器配置太低了。<br>  一查，果然有很大问题，首先我的统计发现网站访客总共才六个UV，而日志文件就占了三十几个G，这是多大的访问量啊，要真是真的用户访问就好了。。。</p>
<pre><code class="language-javascript"><span class="code-block">request <span class="hljs-attr">originalUrl</span>:<span class="hljs-regexp">/otsmobile/</span>app/mgs/mgw.<span class="hljs-property">htm</span>
request client <span class="hljs-attr">ip</span>:<span class="hljs-number">110.99</span><span class="hljs-number">.245</span><span class="hljs-number">.149</span>
request <span class="hljs-attr">hostname</span>:---.---.---.---</span>
</code><span class="copy-button">复制代码</span></pre>
<p>  在日志中发现了这种访问路径，好奇怪呢，自己网站上根本没有这个访问路径才对呀，而且访问是直接使用的ip来访问的服务器，没有通过我的域名来访问。我再百度一下就发现，已经有不少人提到这个情况了。有的说是有人做了域名恶意解析到自己服务器上来，有的说是抢票软件捣的鬼。但是不管怎么说，肯定是妨碍到咱们这种小网站的生存了啊，必须得想个办法处理下才行。<br>  说到这里，咱们还是对 “域名恶意解析” 这种损人利己的行为做些了解吧。<br>  1. 什么是域名恶意解析？<br>  简单说就是其他域名持有者，在不经过自己同意，将其域名解析到自己所持有的服务器公网IP上，间接或直接造成损害他人利益的行为。<br>  2. 别人域名解析到自己服务器上可能会造成什么危害呢？<br>  如果这个域名是未备案的，或者是曾经指向非法网站，就有可能拉低自己网站的SEO排名，SEO排名被其他解析到自己服务器的域名挤占，而且就算域名本身没什么问题，但是流量也会被劫持到别的域名，甚至造成自己站点被工信部封杀等等。而且因为是一些对于自己网站没有意义的访问，还会浪费自己网站的流量带宽，耗费cpu等资源，拖慢网站的访问速度，真的好可恶啊。<br>  3. 解决方法:<br>  百度搜索一下就发现已经有很多解决办法了，如配置nginx、apache等等。但是在我这里，因为服务器本来配置就低，当初就是想的能尽量的把服务器资源分配给node，作为解决应答等，所以也不想搭建nginx服务器了。我这里用的koa2做的web框架，所以直接写个过滤非法域名访问的中间件就可以了,如：<br><span class="figure"><img src="/datas/publicstatic/uploadimg/202301/fITHZpVUAlsOyYJHDnh1674121338073.png" title="" alt="" zoom="" class="medium-zoom-image"><span class="figcaption"></span></span></p>
<p>  随后我们可以看到效果也是比较显著的，cpu和带宽流量已经降下来了：<br><span class="figure"><img src="/datas/publicstatic/uploadimg/202301/lASKfQqjjIaLwUiCZOt1674121346661.png" title="" alt="" zoom="" class="medium-zoom-image"><span class="figcaption"></span></span></p>
<p>  网站访问速度也是一下子就提升上来了有木有 O(∩_∩)O</p>
